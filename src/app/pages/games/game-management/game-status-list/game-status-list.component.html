<div class="game-management-wrapper">
  <div class="carousel-container mb-10">
    <app-game-carousel [connectedDropLists]="dropListIds" (gameClicked)="onGameClicked($event)">
    </app-game-carousel>
  </div>

  <div class="container-overflow">
    <div class="status-column" *ngFor="let status of statusList">

      <div class="status-header fs-18 text-center mb-10 bold d-flex jc-between align-center gap-10"
        [ngClass]="{ 'clickable-header': viewport.isMobile() }" (click)="viewport.isMobile() && toggleCollapse(status)">
        <span>
          {{ getStatusLabel(status) }}
          <span class="game-count">({{ statusGames[status]?.length || 0 }})</span>
        </span>

        <app-fa-icon *ngIf="viewport.isMobile()" class="collapse-icon" [ngClass]="{ 'rotated': !isCollapsed(status) }"
          [icon]="isCollapsed(status) ? 'chevron-down' : 'chevron-up'" />
      </div>

      <div class="status-dropzone gap-10" *ngIf="!viewport.isMobile()" cdkDropList [id]="'status-drop-' + status"
        [cdkDropListData]="statusGames[status]" [cdkDropListConnectedTo]="dropListIds" cdkDropListSortingDisabled="true"
        (cdkDropListDropped)="onDrop($event, status)" (cdkDropListEntered)="onDropListEnter(status)"
        (cdkDropListExited)="onDropListExit(status)">

        <div *ngFor="let game of statusGames[status]" class="game-icon" cdkDrag [cdkDragData]="game"
          (click)="onGameClicked(game)">
          <img [src]="getFullCoverUrl(game.coverImage)" [alt]="game.title" />
          <button class="times-icon-button" (click)="removeGame(game); $event.stopPropagation()">
            <app-fa-icon icon="times" />
          </button>
        </div>

        <div class="empty-dropzone text-center" *ngIf="statusGames[status].length === 0 && !hoveredStatus[status]">
          <span>Arraste jogos para aqui</span>
        </div>
      </div>

      <div class="game-drawer" *ngIf="viewport.isMobile() && !isCollapsed(status)" cdkDropList
        [id]="'status-drop-' + status" [cdkDropListData]="statusGames[status]" [cdkDropListConnectedTo]="dropListIds"
        cdkDropListSortingDisabled="true" (cdkDropListDropped)="onDrop($event, status)">

        <div *ngFor="let game of statusGames[status]" class="game-icon" cdkDrag [cdkDragData]="game"
          [cdkDragDisabled]="true" (click)="onGameClicked(game)">
          <img [src]="getFullCoverUrl(game.coverImage)" [alt]="game.title" />
          <button class="times-icon-button" (click)="removeGame(game); $event.stopPropagation()">
            <app-fa-icon icon="times" />
          </button>
        </div>

        <div class="empty-dropzone text-center" *ngIf="statusGames[status].length === 0 && !hoveredStatus[status]">
          <span>Arraste jogos para aqui</span>
        </div>

      </div>
    </div>
  </div>
</div>

<app-assign-status *ngIf="showAssignStatusModal && selectedGame() as game" [game]="game"
  [currentStatus]="selectedGameStatus" (statusSelected)="onStatusSelected($event)"
  (closed)="showAssignStatusModal = false">
</app-assign-status>